% Image enhancement

clc;
clear all;
close all;

imagePath='C:/Users/gurpu/Desktop/Capstone/dataset ct/COVID19-1/NCP/103/1344';
fldr = imagePath;
a = dir(fullfile(fldr, '*.png'));
n = numel(a);

for i=0:n-1 % automation of enhancing images per patient
    cnt = i;

    if (i<10)
        chr = '000';
    else
        chr = '00';
    end
    chr1  = int2str(cnt);
    chr2 = '.png';
    chr3='.tif';
    imgname = append(chr,chr1,chr2); % append the image
    imgSaveName=append(chr,chr1,chr3);
    pa = imagePath;
    slash='/';
    path = append(pa,slash,imgname);

    imgname = append('/',imgname);
    
    % path1 = 'C:/Users/gurpu/Desktop/Capstone/dataset ct/COVID-CTset part1/NORMAL/normal2/enhanced images/patient316';
    % path1 = imagePath;
    
    path1 = append(imagePath,slash,'normalized');
    mkdir(path1);
    finalPath = append(path1,slash,imgSaveName); % final path for saving enhanced images
    
    save_path = finalPath;
    
    arr = imread(path); % read the image
    
    nrmlzd = double(arr) / double(max(arr(:))); % convert to double and normalize the values
    
    visualizable_image = uint16(nrmlzd * (2^16 - 1)); % convert new image to datatype uint16
    
    visualizable_image=uint16(visualizable_image);
    imwrite(visualizable_image, save_path); % saving the image

end
